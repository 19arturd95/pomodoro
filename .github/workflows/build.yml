name: Build Raycast Extension (macOS)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm ci || npm install
      - run: npx tsc --noEmit

      - name: Show file tree
        run: ls -la && echo && ls -la src || true

      - name: Show package.json
        run: cat package.json

      - name: Raycast build
        run: npx @raycast/api@latest build --no-emoji --non-interactive

      - name: Archive build output
        run: tar -czvf extension-build.tar.gz dist || echo "No dist produced"

      - uses: actions/upload-artifact@v4
        if: success()
        with:
          name: raycast-extension-build
          path: extension-build.tar.gz
